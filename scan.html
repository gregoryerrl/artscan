<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Artwork Scanner</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Load cache module first -->
    <script src="opencv-cache.js"></script>
    <!-- Load face-api.js for face recognition (Layer 1) -->
    <script defer src="node_modules/face-api.js/dist/face-api.min.js"></script>
    <!-- Load OpenCV.js locally for ORB matching (Layer 2 fallback) -->
    <script async src="lib/opencv.js" type="text/javascript"></script>
</head>
<body>
    <!-- Full-Screen Camera View -->
    <div id="scanner-view" class="scanner-view">
        <video id="camera" autoplay playsinline muted></video>
        <canvas id="capture-canvas" style="display: none;"></canvas>

        <!-- Status Overlay -->
        <div id="status-overlay" class="status-overlay">
            <p id="status-text">‚è≥ Loading OpenCV.js...</p>
            <!-- Scanning animation indicator -->
            <div id="scanning-indicator" class="scanning-indicator" style="display: none;">
                <div class="scanning-line"></div>
            </div>
        </div>

        <!-- Stop & View Logs Button (floating) -->
        <button id="stop-view-logs-btn" class="stop-view-logs-btn" style="display: none;">
            üõë Stop & View Logs
        </button>

        <!-- Capture Button -->
        <button id="capture-btn" class="capture-btn" style="display: none;">
            <svg width="80" height="80" viewBox="0 0 80 80">
                <circle cx="40" cy="40" r="35" fill="white" opacity="0.9"/>
                <circle cx="40" cy="40" r="30" fill="none" stroke="#3498db" stroke-width="3"/>
            </svg>
        </button>

        <!-- Permission Prompt -->
        <div id="permission-prompt" class="permission-prompt" style="display: none;">
            <div class="permission-content">
                <div class="permission-icon">üì∑</div>
                <h2>Camera Access Required</h2>
                <p>Allow camera access to scan artworks</p>
                <button id="request-permission-btn" class="btn btn-primary">Enable Camera</button>
                <button id="use-upload-btn" class="btn btn-secondary">Upload Image Instead</button>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="result-modal" class="result-modal" style="display: none;">
        <div class="result-content">
            <button id="close-result-btn" class="close-result-btn">&times;</button>
            <div id="result-display"></div>
            <button id="scan-again-btn" class="btn btn-primary btn-block">Scan Another</button>
        </div>
    </div>

    <!-- Logs Viewer Modal -->
    <div id="logs-modal" class="result-modal" style="display: none;">
        <div class="result-content">
            <button id="close-logs-btn" class="close-result-btn">&times;</button>
            <div id="logs-display">
                <div class="result-no-match">
                    <h3>üìä Diagnostic Logs</h3>
                    <p id="logs-info" style="margin: 1rem 0; font-size: 0.95rem;"></p>
                    <button id="copy-logs-modal-btn" class="btn btn-primary btn-block" style="margin-bottom: 1rem;">
                        üìã Copy Logs to Clipboard
                    </button>
                    <button id="resume-scan-btn" class="btn btn-secondary btn-block">
                        ‚ñ∂Ô∏è Resume Scanning
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- File Upload (Hidden) -->
    <input type="file" id="file-upload" accept="image/*" capture="environment" style="display: none;">

    <!-- Main Application Script -->
    <script src="scan.js"></script>
</body>
</html>
